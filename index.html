<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SchahlLED | Map-Configurator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0?external=react,react-dom",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
    <style>
        :root {
            --schahl-blue: #00B2FF;
            --schahl-dark: #00040D;
            --led-glow: rgba(0, 178, 255, 0.4);
            --light-edge: rgba(255, 255, 255, 0.2);
            --dark-edge: rgba(0, 0, 0, 0.9);
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--schahl-dark); 
            color: #f8fafc; 
            margin: 0; 
            min-height: 100vh;
            overflow-x: hidden;
        }

        .sky-wrapper {
            position: fixed;
            inset: 0;
            z-index: -10;
            background: radial-gradient(circle at 50% 50%, #000c29 0%, #00040D 100%);
            overflow: hidden;
            pointer-events: none;
        }

        .milky-way {
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse at center, rgba(100, 150, 255, 0.12) 0%, transparent 60%),
                radial-gradient(ellipse at 40% 40%, rgba(138, 43, 226, 0.08) 0%, transparent 40%),
                radial-gradient(ellipse at 60% 60%, rgba(0, 178, 255, 0.05) 0%, transparent 50%);
            transform: rotate(-25deg);
            filter: blur(150px);
        }

        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(255,255,255,0.8);
        }
        @keyframes twinkling {
            0%, 100% { opacity: 0.2; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        .twinkle { animation: twinkling var(--dur) infinite ease-in-out; }

        .cc-header {
            background: #00040D;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            height: 130px;
            position: sticky;
            top: 0;
            z-index: 5000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
        }

        .brand-logo-container {
            background: white;
            padding: 12px 18px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }
        .brand-logo-container:hover { transform: scale(1.05); }
        .brand-logo-img { height: 90px; width: auto; }

        .glass-card {
            background: rgba(10, 20, 35, 0.88);
            backdrop-filter: blur(40px);
            border-top: 1px solid var(--light-edge);
            border-left: 1px solid var(--light-edge);
            border-bottom: 5px solid var(--dark-edge);
            border-right: 5px solid var(--dark-edge);
            border-radius: 24px;
            box-shadow: 30px 30px 70px rgba(0,0,0,0.95);
        }

        .led-button {
            background: var(--schahl-blue);
            border-top: 2px solid rgba(255,255,255,0.4);
            border-left: 2px solid rgba(255,255,255,0.4);
            border-bottom: 5px solid rgba(0,0,0,0.7);
            border-right: 5px solid rgba(0,0,0,0.7);
            box-shadow: 0 0 25px var(--led-glow);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 900;
            color: white;
        }
        .led-button:hover:not(:disabled) {
            transform: translate(-3px, -3px);
            box-shadow: 0 0 50px var(--schahl-blue);
            filter: brightness(1.2);
        }

        .input-bezel {
            background: rgba(0, 0, 0, 0.6);
            border-bottom: 1px solid var(--light-edge);
            border-right: 1px solid var(--light-edge);
            border-top: 4px solid var(--dark-edge);
            border-left: 4px solid var(--dark-edge);
            box-shadow: inset 4px 4px 15px rgba(0,0,0,0.9);
        }

        .help-scroll::-webkit-scrollbar { width: 10px; }
        .help-scroll::-webkit-scrollbar-thumb { background: var(--schahl-blue); border-radius: 10px; border: 3px solid #00040D; }

        .pattern-dot {
            width: 30px; height: 30px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); transition: all 0.2s;
            cursor: pointer;
        }
        .pattern-dot.active { background: var(--schahl-blue); border-color: white; box-shadow: 0 0 15px var(--schahl-blue); }

        .step-path {
            position: relative; padding-left: 45px; border-left: 2px solid rgba(0, 178, 255, 0.3); margin-bottom: 40px;
        }
        .step-path::before {
            content: ''; position: absolute; left: -9px; top: 0; width: 16px; height: 16px; background: var(--schahl-blue); border-radius: 50%; box-shadow: 0 0 20px var(--schahl-blue);
        }
        .support-card {
            background: linear-gradient(135deg, rgba(0, 178, 255, 0.1) 0%, rgba(0, 0, 0, 0.5) 100%);
            border: 1px solid rgba(0, 178, 255, 0.3);
            border-radius: 24px;
            padding: 24px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react,typescript">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Upload, Download, Search, ChevronDown, Settings, ArrowRight, Trash2, HelpCircle, Info, X,
            Wifi, RefreshCw, Monitor, Usb, MousePointerClick, AlertTriangle, User, Headphones, Activity, ListChecks, ShieldCheck, Lock, Check, Zap, Sun, LayoutDashboard, FileText
        } from 'lucide-react';

        // --- BACKGROUND ---
        const SkyBackground = () => {
            const stars = useMemo(() => {
                return Array.from({ length: 800 }).map((_, i) => ({
                    id: i,
                    top: `${Math.random() * 100}%`,
                    left: `${Math.random() * 100}%`,
                    size: Math.random() * 2 + 0.3,
                    color: Math.random() > 0.8 ? (Math.random() > 0.5 ? '#9bb0ff' : '#ffcc33') : '#ffffff',
                    twinkle: Math.random() > 0.4,
                    dur: `${Math.random() * 5 + 2}s`
                }));
            }, []);

            return (
                <div className="sky-wrapper">
                    <div className="milky-way"></div>
                    <div className="star-layer">
                        {stars.map(s => (
                            <div key={s.id} className={`star ${s.twinkle ? 'twinkle' : ''}`} style={{ 
                                top: s.top, left: s.left, width: `${s.size}px`, height: `${s.size}px`, 
                                backgroundColor: s.color, '--dur': s.dur 
                            }} />
                        ))}
                    </div>
                </div>
            );
        };

        // --- UI COMPONENTS ---
        const SearchableSelect = ({ options, value, onChange, placeholder = "Seriennummer wählen..." }) => {
            const [isOpen, setIsOpen] = useState(false);
            const [search, setSearch] = useState('');
            const ref = useRef(null);

            useEffect(() => {
                const handleClickOutside = (e) => { if (ref.current && !ref.current.contains(e.target)) setIsOpen(false); };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const filtered = options.filter(o => o.value.toUpperCase().includes(search.toUpperCase()));
            const selected = options.find(o => o.value === value);

            return (
                <div className="relative w-full" ref={ref}>
                    <div onClick={() => setIsOpen(!isOpen)} className="input-bezel rounded-xl px-6 py-4 text-white font-mono cursor-pointer flex justify-between items-center hover:border-blue-400 transition-all">
                        <span className={!selected ? 'text-slate-500' : ''}>{selected ? selected.value : placeholder}</span>
                        <ChevronDown size={18} className={`transition-transform ${isOpen ? 'rotate-180' : ''}`} />
                    </div>
                    {isOpen && (
                        <div className="absolute z-[10000] w-full mt-2 bg-slate-900 border border-white/10 rounded-2xl shadow-[0_20px_50px_rgba(0,0,0,0.8)] overflow-hidden animate-in fade-in zoom-in-95 duration-200">
                            <div className="p-4 border-b border-white/5">
                                <input autoFocus type="text" placeholder="Suchen (letzte Ziffern)..." value={search} onChange={e => setSearch(e.target.value)} className="w-full bg-black/60 rounded-lg px-4 py-2 text-sm text-white outline-none focus:ring-1 focus:ring-blue-500" />
                            </div>
                            <div className="max-h-60 overflow-y-auto help-scroll bg-slate-900">
                                {filtered.map(opt => (
                                    <div key={opt.value} onClick={() => { onChange(opt.value); setIsOpen(false); setSearch(''); }} className={`px-6 py-4 flex items-center justify-between cursor-pointer hover:bg-blue-500/10 ${value === opt.value ? 'bg-blue-500/20 text-blue-400' : 'text-slate-300'}`}>
                                        <div className="flex flex-col">
                                            <span className="font-mono text-sm">{opt.value}</span>
                                            {opt.network && <span className="text-[10px] text-slate-500 uppercase font-black">{opt.network}</span>}
                                        </div>
                                        {value === opt.value && <Check size={16} />}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const SupportSection = ({ title }) => (
            <div className="support-card space-y-6">
                <h4 className="text-white font-black text-base uppercase flex items-center gap-4"><Headphones size={24} className="text-blue-400"/> {title}</h4>
                <div className="grid grid-cols-1 gap-4 text-xs">
                    <div className="flex items-center gap-4 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
                        <User size={24} className="text-blue-400"/>
                        <div>
                            <p className="text-[10px] text-slate-500 uppercase font-black">Patrick Hartmann (Service)</p>
                            <p className="text-white font-bold">Mobil: 0176 80536466</p>
                            <p className="text-white font-bold">Festnetz (Handy): 089 9011982-36</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-4 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
                        <ShieldCheck size={24} className="text-blue-400"/>
                        <div>
                            <p className="text-[10px] text-slate-500 uppercase font-black">Daniel Seehaus (Technischer Leiter)</p>
                            <p className="text-white font-bold">Zentrale: 089 9011982-20</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-4 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
                        <Activity size={24} className="text-blue-400"/>
                        <div>
                            <p className="text-[10px] text-slate-500 uppercase font-black">SchahlLED Zentrale</p>
                            <p className="text-white font-bold">089 9011982-0</p>
                        </div>
                    </div>
                </div>
            </div>
        );

        const HelpModal = ({ onClose }) => {
            const [tab, setTab] = useState('commission');
            return (
                <div className="fixed inset-0 z-[6000] flex items-center justify-center bg-black/95 backdrop-blur-2xl p-8">
                    <div className="glass-card w-full max-w-6xl max-h-[92vh] overflow-hidden flex flex-col shadow-[0_0_100px_rgba(0,178,255,0.15)]">
                        <div className="p-10 border-b border-white/10 flex justify-between items-center bg-black/40">
                            <div className="flex items-center gap-8"><HelpCircle className="text-blue-400" size={44} /><h2 className="text-3xl font-black text-white uppercase tracking-widest">Technischer Leitfaden</h2></div>
                            <button onClick={onClose} className="p-3 hover:bg-white/10 rounded-full transition-all"><X size={36} className="text-slate-500 hover:text-white"/></button>
                        </div>
                        <div className="flex bg-black/60 border-b border-white/10">
                            <button onClick={() => setTab('commission')} className={`px-16 py-8 text-sm font-black uppercase tracking-widest transition-all ${tab === 'commission' ? 'text-blue-400 border-b-4 border-blue-500 bg-blue-500/10' : 'text-slate-500 hover:text-slate-100'}`}>Leuchten Finden & Zuweisen</button>
                            <button onClick={() => setTab('reset')} className={`px-16 py-8 text-sm font-black uppercase tracking-widest transition-all ${tab === 'reset' ? 'text-blue-400 border-b-4 border-blue-500 bg-blue-500/10' : 'text-slate-500 hover:text-slate-100'}`}>Leuchten Reset (USB)</button>
                        </div>
                        <div className="p-16 overflow-y-auto help-scroll flex-1 bg-[#010815]">
                            {tab === 'commission' ? (
                                <div className="grid lg:grid-cols-2 gap-16 text-slate-200">
                                    <div className="space-y-10">
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><Monitor size={24} className="text-blue-400"/> 1. Add Fixtures Wizard</h4>
                                            <p className="text-sm leading-relaxed">Öffnen Sie <b>Add Fixtures</b>. Wählen Sie im Wizard den Punkt: <br/><br/>
                                            <span className="text-white font-bold bg-blue-900/40 px-4 py-3 rounded-xl border border-blue-500/40 inline-block">"discovering them using a USB Wireless Adapter"</span><br/><br/>Klicken Sie auf <b>Next</b>.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><RefreshCw size={24} className="text-blue-400"/> 2. Netzwerk & Discover</h4>
                                            <p className="text-sm leading-relaxed">Wählen Sie das Netzwerk und klicken Sie auf <b>Discover</b>. <br/><br/>
                                            <span className="text-blue-400 font-black block bg-blue-500/10 p-5 border border-blue-400/40 rounded-2xl">3-MAL-REGEL: Klicken Sie insgesamt 3-mal hintereinander auf Discover! Warten Sie nach jedem Klick 15-20 Sekunden.</span><br/>Wichtig: Mit Wireless Stick nah an der Leuchte sein. Bei Bedarf <b>"Scan for Networks"</b> nutzen.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><MousePointerClick size={24} className="text-blue-400"/> 3. Edit Fixture (Zuweisung)</h4>
                                            <p className="text-sm leading-relaxed">Rechtsklick auf die Leuchte im Plan. <br/><br/>Klicken Sie unten rechts auf das <b>Plus (+) Symbol</b>. Wählen Sie das korrekte Netzwerk unter <b>Current Network</b> aus und drücken Sie <b>OK</b>.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><Wifi size={24} className="text-blue-400"/> 4. Synchronisation (Sync Map)</h4>
                                            <p className="text-sm leading-relaxed">Leuchte auswählen und oben auf <b>Sync Map</b> klicken. Reiter <b>"Use USB Wireless Adapter only"</b> wählen -> <b>Next</b>.</p>
                                        </div>
                                    </div>
                                    <SupportSection title="Support (Zentrale & Technik)" />
                                </div>
                            ) : (
                                <div className="grid lg:grid-cols-2 gap-16 text-slate-200">
                                    <div className="space-y-10">
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><Usb size={24} className="text-blue-400"/> 1. Hardware Verbindung</h4>
                                            <p className="text-sm leading-relaxed">Verbinden Sie die Leuchte per USB (TTL oder Micro) mit Ihrem PC.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><MousePointerClick size={24} className="text-blue-400"/> 2. Menü: Advanced > Reset Items</h4>
                                            <p className="text-sm leading-relaxed">Machen Sie einen <b>Rechtsklick</b> auf die Leuchte. Wählen Sie <b>"Advanced"</b> -> <b>"Reset Items"</b>.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><ListChecks size={24} className="text-blue-400"/> 3. Auswahl & Durchführung</h4>
                                            <p className="text-sm leading-relaxed">Wählen Sie <b>"Reset to Factory Default Network"</b>. Klicken Sie auf <b>"Reset via USB"</b> und warten Sie ab.</p>
                                        </div>
                                        <div className="bg-amber-900/20 border border-amber-500/30 p-8 rounded-3xl flex items-start gap-6">
                                            <AlertTriangle size={36} className="text-amber-500 shrink-0"/>
                                            <p className="text-sm leading-relaxed font-bold uppercase tracking-tight">Wichtig: Nach dem Reset MUSS die Leuchte mit dem <b>Wireless Stick</b> wieder synchronisiert werden (Sync Map)!</p>
                                        </div>
                                    </div>
                                    <SupportSection title="Technischer Support (Zusatz)" />
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const PatternLock = ({ onSuccess, onClose }) => {
            const [pattern, setPattern] = useState([]);
            const correctPattern = [0, 1, 2, 5, 8]; 
            
            const handleDot = (idx) => {
                if (pattern.includes(idx)) return;
                const newPattern = [...pattern, idx];
                setPattern(newPattern);
                if (newPattern.length === correctPattern.length) {
                    if (newPattern.every((v, i) => v === correctPattern[i])) onSuccess();
                    else setTimeout(() => setPattern([]), 500);
                }
            };

            return (
                <div className="fixed inset-0 z-[8000] bg-black/90 backdrop-blur-xl flex items-center justify-center p-8">
                    <div className="glass-card p-16 text-center space-y-12">
                        <Lock className="mx-auto text-blue-400" size={64} />
                        <h2 className="text-2xl font-black uppercase tracking-widest text-white">ADMIN AUTH</h2>
                        <div className="grid grid-cols-3 gap-8 mx-auto w-fit p-10 bg-black/40 rounded-3xl border border-white/5">
                            {[0,1,2,3,4,5,6,7,8].map(i => (
                                <button key={i} onMouseDown={() => handleDot(i)} onMouseEnter={(e) => e.buttons === 1 && handleDot(i)} className={`pattern-dot ${pattern.includes(i) ? 'active' : ''}`} />
                            ))}
                        </div>
                        <button onClick={onClose} className="text-slate-500 uppercase font-black text-xs hover:text-white transition-colors">Abbrechen</button>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [file, setFile] = useState(null);
            const [showHelp, setShowHelp] = useState(false);
            const [showAdminLock, setShowAdminLock] = useState(false);
            const [isAdminMode, setIsAdminMode] = useState(false);
            const [view, setView] = useState('config'); // 'config' or 'admin'
            
            const [activeTab, setActiveTab] = useState('patch');
            const [serialOptions, setSerialOptions] = useState([]);
            const [patchJobs, setPatchJobs] = useState([{ id: Date.now(), oldSN: '', newSN: '' }]);
            const [dhJobs, setDhJobs] = useState([{ id: Date.now(), sourceSN: '', targetSN: '' }]);
            
            const [isDone, setIsDone] = useState(false);
            const [dlUrl, setDlUrl] = useState(null);

            const handleFileUpload = (e) => {
                const f = e.target.files[0];
                if (!f) return;
                const r = new FileReader();
                r.onload = (ev) => {
                    const content = ev.target.result;
                    setFile({ name: f.name, content });
                    const netRegex = /<pmu\s+[^>]*sn="([^"]+)"\s+[^>]*network="([^"]+)"/gi;
                    const matches = []; let match;
                    while ((match = netRegex.exec(content)) !== null) matches.push({ value: match[1], network: match[2] });
                    setSerialOptions(Array.from(new Map(matches.map(m => [m.value, m])).values()));
                };
                r.readAsText(f);
            };

            const runConfig = () => {
                let res = file.content;
                patchJobs.forEach(job => {
                    if (job.oldSN && job.newSN) res = res.replace(new RegExp(`sn\\s*=\\s*"${job.oldSN}"`, 'gi'), `sn="${job.newSN}"`);
                });
                dhJobs.forEach(job => {
                    if (!job.sourceSN || !job.targetSN) return;
                    const sourceMatch = res.match(new RegExp(`<pmu[^>]*sn="${job.sourceSN}"([^>]*)>`, 'i'));
                    if (sourceMatch) {
                        const attrs = sourceMatch[1].match(/(cal_[^=]+|lux_[^=]+|occupied_[^=]+|vacant_[^=]+)="[^"]*"/gi);
                        if (attrs) {
                            res = res.replace(new RegExp(`<pmu[^>]*sn="${job.targetSN}"([^>]*)>`, 'i'), (full, cAttrs) => {
                                let updated = cAttrs;
                                attrs.forEach(a => {
                                    const name = a.split('=')[0];
                                    const r = new RegExp(`${name}="[^"]*"`, 'i');
                                    updated = updated.match(r) ? updated.replace(r, a) : updated + ` ${a}`;
                                });
                                return `<pmu sn="${job.targetSN}"${updated}>`;
                            });
                        }
                    }
                });
                setDlUrl(URL.createObjectURL(new Blob([res], { type: 'text/plain' })));
                setIsDone(true);
            };

            return (
                <div className="min-h-screen flex flex-col relative">
                    <SkyBackground />
                    <header className="cc-header flex items-center justify-between px-16">
                        <div className="flex items-center gap-14">
                            <a href="#" className="brand-logo-container"><img src="https://www.thorlux.de/assets/images/schahlled-logo-colour-c4e9ae384335c5a599815fb347bd845a.svg" className="brand-logo-img" /></a>
                            <div className="flex items-center gap-6">
                                <img src="https://www.schahlled-control-center.de/build/img/schahlled/brand-logo.b4d1183a.svg" className="h-10" />
                                {isAdminMode && (
                                    <div className="flex bg-white/5 p-1 rounded-xl border border-white/10 ml-10">
                                        <button onClick={() => setView('config')} className={`px-6 py-2 rounded-lg text-xs font-black uppercase tracking-widest flex items-center gap-2 transition-all ${view === 'config' ? 'bg-blue-500 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}><LayoutDashboard size={14}/> Config</button>
                                        <button onClick={() => setView('admin')} className={`px-6 py-2 rounded-lg text-xs font-black uppercase tracking-widest flex items-center gap-2 transition-all ${view === 'admin' ? 'bg-blue-500 text-white shadow-lg' : 'text-slate-500 hover:text-white'}`}><FileText size={14}/> Service</button>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div className="flex items-center gap-12">
                            <button onClick={() => isAdminMode ? setView('admin') : setShowAdminLock(true)} className={`text-[13px] font-black flex items-center gap-3 tracking-[0.5em] uppercase hover:text-white transition-all transform hover:scale-105 ${isAdminMode ? 'text-blue-400' : 'text-slate-500'}`}><Lock size={22}/> ADMIN</button>
                            <button onClick={() => setShowHelp(true)} className="text-[13px] font-black text-blue-400 flex items-center gap-3 tracking-[0.5em] uppercase hover:text-white transition-all transform hover:scale-105"><HelpCircle size={26}/> HILFE</button>
                        </div>
                    </header>

                    <main className="flex-1 flex flex-col items-center p-14 z-10">
                        {view === 'admin' ? (
                            <div className="w-full max-w-7xl animate-in fade-in slide-in-from-bottom-10 duration-500">
                                <div className="glass-card p-20 text-center space-y-10">
                                    <h2 className="text-5xl font-light tracking-[0.4em] text-white uppercase">Serviceprotokolle</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-10 py-20">
                                        {[1,2,3].map(i => (
                                            <div key={i} className="input-bezel p-10 rounded-3xl border border-white/5 text-slate-500 flex flex-col items-center justify-center gap-6">
                                                <FileText size={48} className="opacity-20" />
                                                <p className="font-black text-xs uppercase tracking-widest opacity-30">In Vorbereitung</p>
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={() => setView('config')} className="led-button px-16 py-6 rounded-2xl text-xs tracking-[0.3em]">ZURÜCK ZUM CONFIGURATOR</button>
                                </div>
                            </div>
                        ) : (
                            <div className="w-full max-w-7xl space-y-20">
                                <div className="text-center space-y-10">
                                    <h1 className="text-7xl font-light text-white uppercase tracking-[0.6em] ml-[0.6em] filter drop-shadow-[0_0_40px_rgba(0,178,255,0.45)]">MAP-CONFIGURATOR</h1>
                                    <div className="w-56 h-1 bg-blue-500 mx-auto rounded-full led-status-dot shadow-[0_0_20px_var(--schahl-blue)]"></div>
                                </div>

                                {!file ? (
                                    <div className="glass-card p-40 flex flex-col items-center border-dashed border-2 border-slate-700 hover:border-blue-400 cursor-pointer relative group transition-all hover:scale-[1.01]">
                                        <Upload className="w-20 h-20 text-blue-400 mb-8 animate-bounce" />
                                        <h2 className="text-4xl font-black text-white uppercase tracking-widest">.MAP Datei laden</h2>
                                        <input type="file" accept=".map" className="absolute inset-0 opacity-0 cursor-pointer" onChange={handleFileUpload} />
                                    </div>
                                ) : (
                                    <div className="grid lg:grid-cols-12 gap-16 animate-in fade-in duration-500">
                                        <div className="lg:col-span-8 glass-card overflow-visible flex flex-col border-white/5">
                                            <div className="flex bg-black/40 border-b border-white/10 rounded-t-3xl overflow-hidden">
                                                <button onClick={() => setActiveTab('patch')} className={`flex-1 py-8 text-xs font-black uppercase tracking-[0.3em] transition-all flex items-center justify-center gap-4 ${activeTab === 'patch' ? 'text-blue-400 bg-blue-500/10 border-b-2 border-blue-500' : 'text-slate-500 hover:text-white'}`}><Zap size={18}/> SN Patching</button>
                                                <button onClick={() => setActiveTab('dh')} className={`flex-1 py-8 text-xs font-black uppercase tracking-[0.3em] transition-all flex items-center justify-center gap-4 ${activeTab === 'dh' ? 'text-blue-400 bg-blue-500/10 border-b-2 border-blue-500' : 'text-slate-500 hover:text-white'}`}><Sun size={18}/> DH Transfer</button>
                                            </div>
                                            
                                            <div className="p-12 space-y-10 min-h-[500px]">
                                                {activeTab === 'patch' ? (
                                                    <>
                                                        <button onClick={() => setPatchJobs([...patchJobs, { id: Date.now(), oldSN: '', newSN: '' }])} className="w-full py-6 input-bezel text-blue-400 font-black rounded-2xl uppercase tracking-[0.3em] hover:brightness-125 transition-all shadow-xl">+ SN-Tausch hinzufügen</button>
                                                        {patchJobs.map((job) => (
                                                            <div key={job.id} className="bg-black/40 p-8 rounded-3xl border border-white/5 flex items-center gap-10 relative">
                                                                <div className="flex-1 space-y-3">
                                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Quelle (Datei)</label>
                                                                    <SearchableSelect options={serialOptions} value={job.oldSN} onChange={val => setPatchJobs(patchJobs.map(j => j.id === job.id ? {...j, oldSN: val} : j))} />
                                                                </div>
                                                                <ArrowRight size={24} className="text-slate-700 mt-6" />
                                                                <div className="flex-1 space-y-3">
                                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Ersatz (Neu)</label>
                                                                    <input type="text" value={job.newSN} onChange={e => setPatchJobs(patchJobs.map(j => j.id === job.id ? {...j, newSN: e.target.value.toUpperCase()} : j))} className="w-full input-bezel rounded-xl px-6 py-4 text-white font-mono outline-none focus:border-blue-500 transition-all" placeholder="SN123456" />
                                                                </div>
                                                                <button onClick={() => setPatchJobs(patchJobs.filter(j => j.id !== job.id))} className="mt-6 text-slate-700 hover:text-red-500"><Trash2 size={20}/></button>
                                                            </div>
                                                        ))}
                                                    </>
                                                ) : (
                                                    <>
                                                        <button onClick={() => setDhJobs([...dhJobs, { id: Date.now(), sourceSN: '', targetSN: '' }])} className="w-full py-6 input-bezel text-blue-400 font-black rounded-2xl uppercase tracking-[0.3em] hover:brightness-125 transition-all shadow-xl">+ DH-Transfer hinzufügen</button>
                                                        {dhJobs.map((job) => (
                                                            <div key={job.id} className="bg-black/40 p-8 rounded-3xl border border-white/5 flex items-center gap-10 relative">
                                                                <div className="flex-1 space-y-3">
                                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Quelle (Kalibrierung)</label>
                                                                    <SearchableSelect options={serialOptions} value={job.sourceSN} onChange={val => setDhJobs(dhJobs.map(j => j.id === job.id ? {...j, sourceSN: val} : j))} />
                                                                </div>
                                                                <Zap size={24} className="text-blue-500 mt-6 opacity-40" />
                                                                <div className="flex-1 space-y-3">
                                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Ziel (Übernahme)</label>
                                                                    <SearchableSelect options={serialOptions} value={job.targetSN} onChange={val => setDhJobs(dhJobs.map(j => j.id === job.id ? {...j, targetSN: val} : j))} />
                                                                </div>
                                                                <button onClick={() => setDhJobs(dhJobs.filter(j => j.id !== job.id))} className="mt-6 text-slate-700 hover:text-red-500"><Trash2 size={20}/></button>
                                                            </div>
                                                        ))}
                                                    </>
                                                )}
                                            </div>
                                        </div>

                                        <div className="lg:col-span-4 flex flex-col gap-12">
                                            <div className="glass-card p-14 text-center space-y-12 flex flex-col justify-between min-h-[500px]">
                                                <div className="space-y-10">
                                                    <div className="w-24 h-24 mx-auto rounded-full bg-black/60 flex items-center justify-center border-2 border-blue-500/20 shadow-inner">
                                                        <Settings size={48} className={`text-blue-400 ${!isDone && 'animate-spin'}`} style={{ animationDuration: '8s' }} />
                                                    </div>
                                                    <h4 className="text-3xl font-black text-white uppercase tracking-widest">{isDone ? 'READY' : 'STANDBY'}</h4>
                                                    <p className="text-[12px] text-slate-500 truncate border-y border-white/10 py-6 tracking-[0.2em]">{file.name}</p>
                                                </div>
                                                {!isDone ? (
                                                    <button onClick={runConfig} className="w-full py-10 rounded-2xl led-button text-base tracking-[0.4em]">CONFIG ANWENDEN</button>
                                                ) : (
                                                    <div className="space-y-10">
                                                        <div className="bg-emerald-500/10 border border-emerald-500/40 p-8 rounded-2xl text-[11px] text-emerald-400 font-bold uppercase tracking-widest">PATCH ERFOLGREICH</div>
                                                        <a href={dlUrl} download={file.name.replace('.map', '_config.map')} className="flex items-center justify-center w-full py-10 bg-white text-black font-black rounded-2xl uppercase shadow-2xl tracking-[0.5em] hover:scale-105 transition-all"><Download className="mr-4" size={28}/> DOWNLOAD</a>
                                                    </div>
                                                )}
                                                <button onClick={() => {setFile(null); setIsDone(false); setDlUrl(null);}} className="text-slate-600 text-[11px] font-black uppercase tracking-widest hover:text-red-500 transition-colors">Datei wechseln</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}
                    {showAdminLock && <PatternLock onSuccess={() => { setIsAdminMode(true); setView('admin'); setShowAdminLock(false); }} onClose={() => setShowAdminLock(false)} />}
                    <footer className="text-center py-20 opacity-30 border-t border-white/5 bg-black/80">
                        <p className="text-[10px] font-black tracking-[3em] text-slate-600 uppercase ml-[3em]">SchahlLED GmbH • Map-Configurator v6.2</p>
                    </footer>
                </div>
            );
        };
        const root = createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>