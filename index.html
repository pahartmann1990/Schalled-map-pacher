<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SchahlLED | Maintenance Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0?external=react,react-dom",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
    <style>
        :root {
            --schahl-blue: #00B2FF;
            --schahl-dark: #00040D;
            --led-glow: rgba(0, 178, 255, 0.4);
            --light-edge: rgba(255, 255, 255, 0.2);
            --dark-edge: rgba(0, 0, 0, 0.9);
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--schahl-dark); 
            color: #f8fafc; 
            margin: 0; 
            min-height: 100vh;
            overflow-x: hidden;
        }

        .sky-wrapper {
            position: fixed;
            inset: 0;
            z-index: -10;
            background: linear-gradient(to bottom, #00040D 0%, #00091d 100%);
            overflow: hidden;
            pointer-events: none;
        }

        .milky-way {
            position: absolute;
            top: -40%;
            left: -20%;
            width: 150%;
            height: 150%;
            background: 
                radial-gradient(ellipse at center, rgba(100, 150, 255, 0.08) 0%, transparent 70%),
                radial-gradient(ellipse at 40% 40%, rgba(138, 43, 226, 0.05) 0%, transparent 50%);
            transform: rotate(-15deg);
            filter: blur(120px);
        }

        .star-layer { position: absolute; inset: 0; }
        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            opacity: 0.6;
        }
        @keyframes twinkling {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }
        .twinkle { animation: twinkling var(--dur) infinite ease-in-out; }

        .cloud-veil {
            position: absolute;
            background: rgba(255, 255, 255, 0.025);
            filter: blur(100px);
            border-radius: 50%;
            pointer-events: none;
        }
        @keyframes drift {
            from { transform: translateX(-120vw); }
            to { transform: translateX(120vw); }
        }
        .cloud-slow { animation: drift 250s linear infinite; }
        .cloud-mid { animation: drift 180s linear infinite; }

        .cc-header {
            background: #00040D;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            height: 130px;
            position: sticky;
            top: 0;
            z-index: 2000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
        }

        .brand-logo-container {
            background: white;
            padding: 12px 18px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            border: 2px solid rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease;
        }
        .brand-logo-container:hover { transform: scale(1.05); }
        .brand-logo-img { height: 90px; width: auto; }

        .glass-card {
            background: rgba(10, 20, 35, 0.88);
            backdrop-filter: blur(40px);
            border-top: 1px solid var(--light-edge);
            border-left: 1px solid var(--light-edge);
            border-bottom: 5px solid var(--dark-edge);
            border-right: 5px solid var(--dark-edge);
            border-radius: 24px;
            box-shadow: 30px 30px 70px rgba(0,0,0,0.95);
        }

        .led-button {
            background: var(--schahl-blue);
            border-top: 2px solid rgba(255,255,255,0.4);
            border-left: 2px solid rgba(255,255,255,0.4);
            border-bottom: 5px solid rgba(0,0,0,0.7);
            border-right: 5px solid rgba(0,0,0,0.7);
            box-shadow: 0 0 25px var(--led-glow);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: 900;
            color: white;
        }
        .led-button:hover:not(:disabled) {
            transform: translate(-3px, -3px);
            box-shadow: 0 0 50px var(--schahl-blue);
            filter: brightness(1.2);
        }

        .input-bezel {
            background: rgba(0, 0, 0, 0.6);
            border-bottom: 1px solid var(--light-edge);
            border-right: 1px solid var(--light-edge);
            border-top: 4px solid var(--dark-edge);
            border-left: 4px solid var(--dark-edge);
            box-shadow: inset 4px 4px 15px rgba(0,0,0,0.9);
        }

        @keyframes pulse-led {
            0%, 100% { opacity: 0.5; transform: scale(1); filter: drop-shadow(0 0 8px var(--schahl-blue)); }
            50% { opacity: 1; transform: scale(1.1); filter: drop-shadow(0 0 20px var(--schahl-blue)); }
        }
        .led-status-dot { animation: pulse-led 3s infinite ease-in-out; }

        .help-scroll::-webkit-scrollbar { width: 10px; }
        .help-scroll::-webkit-scrollbar-thumb { background: var(--schahl-blue); border-radius: 10px; border: 3px solid #00040D; }

        .step-path {
            position: relative; padding-left: 45px; border-left: 2px solid rgba(0, 178, 255, 0.3); margin-bottom: 40px;
        }
        .step-path::before {
            content: ''; position: absolute; left: -9px; top: 0; width: 16px; height: 16px; background: var(--schahl-blue); border-radius: 50%; box-shadow: 0 0 20px var(--schahl-blue);
        }
        .support-card {
            background: linear-gradient(135deg, rgba(0, 178, 255, 0.1) 0%, rgba(0, 0, 0, 0.5) 100%);
            border: 1px solid rgba(0, 178, 255, 0.3);
            border-radius: 24px;
            padding: 24px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react,typescript">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Upload, Download, Search, ChevronDown, Settings, ArrowRight, Trash2, HelpCircle, Info, X,
            Wifi, RefreshCw, Monitor, Usb, PhoneCall, MousePointerClick, AlertTriangle, User, Headphones, Activity, ListChecks, ShieldCheck
        } from 'lucide-react';

        const SkyBackground = () => {
            const stars = useMemo(() => {
                return Array.from({ length: 280 }).map((_, i) => ({
                    id: i,
                    top: `${Math.random() * 100}%`,
                    left: `${Math.random() * 100}%`,
                    size: Math.random() * 2 + 0.4,
                    twinkle: Math.random() > 0.6,
                    dur: `${Math.random() * 4 + 2}s`
                }));
            }, []);

            return (
                <div className="sky-wrapper">
                    <div className="milky-way"></div>
                    <div className="star-layer">
                        {stars.map(s => (
                            <div 
                                key={s.id}
                                className={`star ${s.twinkle ? 'twinkle' : ''}`}
                                style={{
                                    top: s.top,
                                    left: s.left,
                                    width: `${s.size}px`,
                                    height: `${s.size}px`,
                                    '--dur': s.dur
                                }}
                            />
                        ))}
                    </div>
                    <div className="cloud-veil cloud-slow" style={{ width: '1000px', height: '500px', top: '5%', opacity: 0.2 }}></div>
                    <div className="cloud-veil cloud-mid" style={{ width: '1300px', height: '650px', top: '40%', opacity: 0.15, animationDelay: '-60s' }}></div>
                    <div className="cloud-veil cloud-slow" style={{ width: '800px', height: '400px', top: '75%', opacity: 0.2, animationDelay: '-120s' }}></div>
                </div>
            );
        };

        const SupportSection = ({ title }) => (
            <div className="support-card space-y-6">
                <h4 className="text-white font-black text-base uppercase flex items-center gap-4"><Headphones size={24} className="text-blue-400"/> {title}</h4>
                <div className="grid grid-cols-1 gap-4">
                    <div className="flex items-center gap-4 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
                        <User size={24} className="text-blue-400"/>
                        <div>
                            <p className="text-[10px] text-slate-500 uppercase font-black">Patrick Hartmann (Service)</p>
                            <p className="text-white font-bold">Mobil: 0176 80536466</p>
                            <p className="text-white font-bold">Festnetz (Handy): 089 9011982-36</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-4 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
                        <ShieldCheck size={24} className="text-blue-400"/>
                        <div>
                            <p className="text-[10px] text-slate-500 uppercase font-black">Technischer Leiter (Abteilungsleiter)</p>
                            <p className="text-white font-bold">Zentrale: 089 9011982-20</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-4 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
                        <Activity size={24} className="text-blue-400"/>
                        <div>
                            <p className="text-[10px] text-slate-500 uppercase font-black">SchahlLED Zentrale</p>
                            <p className="text-white font-bold">089 9011982-0</p>
                        </div>
                    </div>
                </div>
            </div>
        );

        const HelpModal = ({ onClose }) => {
            const [tab, setTab] = useState('commission');
            return (
                <div className="fixed inset-0 z-[6000] flex items-center justify-center bg-black/95 backdrop-blur-2xl p-8">
                    <div className="glass-card w-full max-w-6xl max-h-[92vh] overflow-hidden flex flex-col shadow-[0_0_100px_rgba(0,178,255,0.15)]">
                        <div className="p-10 border-b border-white/10 flex justify-between items-center bg-black/40">
                            <div className="flex items-center gap-8">
                                <HelpCircle className="text-blue-400" size={44} />
                                <h2 className="text-3xl font-black text-white uppercase tracking-widest">Technischer Leitfaden</h2>
                            </div>
                            <button onClick={onClose} className="p-3 hover:bg-white/10 rounded-full transition-all"><X size={36} className="text-slate-500 hover:text-white"/></button>
                        </div>
                        <div className="flex bg-black/60 border-b border-white/10">
                            <button onClick={() => setTab('commission')} className={`px-16 py-8 text-sm font-black uppercase tracking-widest transition-all ${tab === 'commission' ? 'text-blue-400 border-b-4 border-blue-500 bg-blue-500/10' : 'text-slate-500 hover:text-slate-100'}`}>Leuchten Finden & Zuweisen</button>
                            <button onClick={() => setTab('reset')} className={`px-16 py-8 text-sm font-black uppercase tracking-widest transition-all ${tab === 'reset' ? 'text-blue-400 border-b-4 border-blue-500 bg-blue-500/10' : 'text-slate-500 hover:text-slate-100'}`}>Leuchten Reset (USB)</button>
                        </div>
                        <div className="p-16 overflow-y-auto help-scroll flex-1 bg-[#010815]">
                            {tab === 'commission' ? (
                                <div className="grid lg:grid-cols-2 gap-16">
                                    <div className="space-y-10">
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><Monitor size={24} className="text-blue-400"/> 1. Add Fixtures Wizard</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Öffnen Sie <b>Add Fixtures</b>. Wählen Sie im Wizard den Punkt: <br/><br/>
                                            <span className="text-white font-bold bg-blue-900/40 px-4 py-3 rounded-xl border border-blue-500/40 inline-block shadow-lg">
                                                "discovering them using a USB Wireless Adapter"
                                            </span><br/><br/>Klicken Sie auf <b>Next</b>.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><RefreshCw size={24} className="text-blue-400"/> 2. Netzwerk & Discover</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Wählen Sie das Netzwerk und klicken Sie auf <b>Discover</b>. <br/><br/>
                                            <span className="text-blue-400 font-black block bg-blue-500/10 p-5 border border-blue-400/40 rounded-2xl">
                                                3-MAL-REGEL: Klicken Sie insgesamt 3-mal hintereinander auf Discover! Warten Sie nach jedem Klick 15-20 Sekunden.
                                            </span>
                                            <br/>Wichtig: Mit Wireless Stick in der Nähe der Leuchte sein. Bei Erfolg Netzwerk merken. Falls nötig <b>"Scan for Networks"</b> nutzen.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><MousePointerClick size={24} className="text-blue-400"/> 3. Edit Fixture (Zuweisung)</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Rechtsklick oder Doppelklick auf die Leuchte im Plan. <br/><br/>
                                            Klicken Sie unten rechts auf das <b>Plus (+) Symbol</b>. Wählen Sie das korrekte Netzwerk unter <b>Current Network</b> aus und drücken Sie <b>OK</b>.</p>
                                        </div>
                                    </div>
                                    <div className="space-y-10">
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><Wifi size={24} className="text-blue-400"/> 4. Synchronisation (Sync Map)</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Leuchte auswählen und oben auf <b>Sync Map</b> klicken. <br/><br/>
                                            Reiter <b>"Use USB Wireless Adapter only"</b> wählen -> <b>Next</b>. Warten bis fertig.</p>
                                        </div>
                                        <SupportSection title="5. Support (Zentrale & Technik)" />
                                    </div>
                                </div>
                            ) : (
                                <div className="grid lg:grid-cols-2 gap-16">
                                    <div className="space-y-10">
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><Usb size={24} className="text-blue-400"/> 1. Hardware Verbindung</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Verbinden Sie die Leuchte per USB (TTL oder Micro) mit Ihrem PC. Stellen Sie sicher, dass die Verbindung stabil ist.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><MousePointerClick size={24} className="text-blue-400"/> 2. Menü: Advanced > Reset Items</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Machen Sie einen <b>Rechtsklick</b> auf die betreffende Leuchte. Wählen Sie den Reiter <b>"Advanced"</b> und dann den Unterpunkt <b>"Reset Items"</b> aus.</p>
                                        </div>
                                        <div className="step-path">
                                            <h4 className="text-white font-black text-base uppercase mb-4 flex items-center gap-4"><ListChecks size={24} className="text-blue-400"/> 3. Auswahl & Durchführung</h4>
                                            <p className="text-slate-200 text-sm leading-relaxed">Wählen Sie die gewünschten Positionen aus (in der Regel nur <b>"Reset to Factory Default Network"</b>). Klicken Sie anschließend auf den Button <b>"Reset via USB"</b> und warten Sie den Vorgang ab. Danach das Fenster schließen.</p>
                                        </div>
                                    </div>
                                    <div className="space-y-10">
                                        <div className="bg-amber-900/20 border border-amber-500/30 p-10 rounded-3xl flex items-start gap-8 shadow-2xl">
                                            <AlertTriangle size={44} className="text-amber-500 shrink-0"/>
                                            <div className="space-y-4">
                                                <h5 className="text-white font-black text-sm uppercase tracking-widest">WICHTIGER ABSCHLUSSSCHRITT</h5>
                                                <p className="text-slate-200 text-sm leading-relaxed font-bold">Nach dem Reset MUSS die Leuchte mit dem <b>Wireless Stick</b> wieder synchronisiert werden (Sync Map), damit sie im System registriert wird!</p>
                                            </div>
                                        </div>
                                        <SupportSection title="Technischer Support (Zusatz)" />
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [file, setFile] = useState(null);
            const [showHelp, setShowHelp] = useState(false);
            const [patchJobs, setPatchJobs] = useState([{ id: Date.now(), oldSN: '', newSN: '' }]);
            const [isDone, setIsDone] = useState(false);
            const [dlUrl, setDlUrl] = useState(null);

            const thorluxLogo = "https://www.thorlux.de/assets/images/schahlled-logo-colour-c4e9ae384335c5a599815fb347bd845a.svg";
            const ccLogo = "https://www.schahlled-control-center.de/build/img/schahlled/brand-logo.b4d1183a.svg";

            const run = () => {
                let res = file.content;
                patchJobs.forEach(job => {
                    if (!job.oldSN || !job.newSN) return;
                    const regex = new RegExp(`sn\\s*=\\s*"${job.oldSN}"`, 'gi');
                    res = res.replace(regex, `sn="${job.newSN}"`);
                });
                setDlUrl(URL.createObjectURL(new Blob([res], { type: 'text/plain' })));
                setIsDone(true);
            };

            return (
                <div className="min-h-screen flex flex-col relative">
                    <SkyBackground />
                    <header className="cc-header flex items-center justify-between px-16">
                        <div className="flex items-center gap-14">
                            <a href="https://www.schahlled.de" target="_blank" rel="noopener" className="brand-logo-container">
                                <img src={thorluxLogo} className="brand-logo-img" alt="SchahlLED" />
                            </a>
                            <a href="https://www.schahlled-control-center.de" target="_blank" rel="noopener" className="flex items-center gap-4 hover:brightness-125 transition-all">
                                <img src={ccLogo} className="h-10" alt="Control Center" />
                                <span className="text-2xl font-black text-slate-500 tracking-tight uppercase">Control Center</span>
                            </a>
                        </div>
                        <button onClick={() => setShowHelp(true)} className="text-[13px] font-black text-blue-400 flex items-center gap-3 tracking-[0.5em] uppercase hover:text-white transition-all transform hover:scale-105">
                            <HelpCircle size={26}/> HILFE
                        </button>
                    </header>

                    <main className="flex-1 flex flex-col items-center p-14 z-10">
                        <div className="w-full max-w-7xl space-y-20">
                            <div className="text-center space-y-10">
                                <h1 className="text-7xl font-light text-white uppercase tracking-[0.6em] ml-[0.6em] filter drop-shadow-[0_0_40px_rgba(0,178,255,0.45)]">MAINTENANCE CONSOLE</h1>
                                <div className="w-56 h-1 bg-blue-500 mx-auto rounded-full led-status-dot"></div>
                            </div>

                            {!file ? (
                                <div className="glass-card p-40 flex flex-col items-center border-dashed border-2 border-slate-700 hover:border-blue-400 cursor-pointer relative group">
                                    <Upload className="w-20 h-20 text-blue-400 mb-8" />
                                    <h2 className="text-4xl font-black text-white uppercase tracking-widest">Map-Datei laden</h2>
                                    <input type="file" accept=".map" className="absolute inset-0 opacity-0 cursor-pointer" onChange={(e) => {
                                        const f = e.target.files[0]; if (f) { const r = new FileReader(); r.onload = (ev) => setFile({ name: f.name, content: ev.target.result }); r.readAsText(f); }
                                    }} />
                                </div>
                            ) : (
                                <div className="grid lg:grid-cols-12 gap-16 animate-in fade-in duration-500">
                                    <div className="lg:col-span-8 glass-card p-12 space-y-10">
                                        <button onClick={() => setPatchJobs([...patchJobs, { id: Date.now(), oldSN: '', newSN: '' }])} className="w-full py-8 input-bezel text-blue-400 font-black rounded-2xl uppercase tracking-[0.4em] hover:brightness-125 transition-all">+ Position hinzufügen</button>
                                        {patchJobs.map((job) => (
                                            <div key={job.id} className="bg-black/40 p-10 rounded-3xl border border-white/5 flex items-center gap-10 relative">
                                                <div className="flex-1 space-y-4">
                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Alte SN</label>
                                                    <input type="text" value={job.oldSN} onChange={e => setPatchJobs(patchJobs.map(j => j.id === job.id ? {...j, oldSN: e.target.value.toUpperCase()} : j))} className="w-full input-bezel rounded-xl px-6 py-4 text-white font-mono outline-none" placeholder="SN123456" />
                                                </div>
                                                <ArrowRight size={30} className="text-slate-700 mt-8" />
                                                <div className="flex-1 space-y-4">
                                                    <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Neue SN</label>
                                                    <input type="text" value={job.newSN} onChange={e => setPatchJobs(patchJobs.map(j => j.id === job.id ? {...j, newSN: e.target.value.toUpperCase()} : j))} className="w-full input-bezel rounded-xl px-6 py-4 text-white font-mono outline-none" placeholder="SN999888" />
                                                </div>
                                                <button onClick={() => setPatchJobs(patchJobs.filter(j => j.id !== job.id))} className="mt-8 text-slate-700 hover:text-red-500 transition-colors"><Trash2 size={24}/></button>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="lg:col-span-4 flex flex-col gap-12">
                                        <div className="glass-card p-14 text-center space-y-12 flex flex-col justify-between min-h-[500px]">
                                            <div className="space-y-10">
                                                <div className="w-24 h-24 mx-auto rounded-full bg-black/60 flex items-center justify-center border-2 border-blue-500/20 shadow-inner">
                                                    <Settings size={48} className={`text-blue-400 ${!isDone && 'animate-spin'}`} style={{ animationDuration: '8s' }} />
                                                </div>
                                                <h4 className="text-3xl font-black text-white uppercase tracking-widest">{isDone ? 'SYSTEM OK' : 'BEREIT'}</h4>
                                                <p className="text-[12px] text-slate-500 italic truncate opacity-80 border-y border-white/10 py-6 tracking-[0.4em] font-black">{file.name}</p>
                                            </div>
                                            {!isDone ? (
                                                <button onClick={run} className="w-full py-10 rounded-2xl led-button text-base tracking-[0.5em]">PATCH STARTEN</button>
                                            ) : (
                                                <div className="space-y-10">
                                                    <div className="bg-emerald-500/10 border border-emerald-500/40 p-8 rounded-2xl text-[11px] text-emerald-400 font-bold italic text-left leading-relaxed">
                                                        <Info className="mb-4" size={20}/> PATCH ERFOLGREICH. Bitte Map drahtlos synchronisieren.
                                                    </div>
                                                    <a href={dlUrl} download={file.name.replace('.map', '_patched.map')} className="flex items-center justify-center w-full py-10 bg-white text-black font-black rounded-2xl uppercase shadow-2xl tracking-[0.5em] text-base hover:bg-slate-100 transition-all"><Download className="mr-4" size={28}/> DOWNLOAD</a>
                                                </div>
                                            )}
                                            <button onClick={() => {setFile(null); setIsDone(false); setDlUrl(null);}} className="text-slate-600 text-[11px] font-black uppercase tracking-widest hover:text-red-500 transition-colors">Andere Map laden</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </main>

                    {showHelp && <HelpModal onClose={() => setShowHelp(false)} />}
                    <footer className="text-center py-20 opacity-30 border-t border-white/5 bg-black/80">
                        <p className="text-[10px] font-black tracking-[3em] text-slate-600 uppercase ml-[3em]">SchahlLED GmbH • Maintenance Console v4.6</p>
                    </footer>
                </div>
            );
        };
        const root = createRoot(document.getElementById('root')); root.render(<App />);
    </script>
</body>
</html>